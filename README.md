# 学食メニュー満足度アプリ

学食のメニューに対するレビューを投稿・閲覧し、データ分析を行うWebアプリケーション  
25年度講義資料  

## 目次

- [機能概要](#機能概要)
- [セットアップ](#セットアップ)
- [使い方](#使い方)
- [画面説明](#画面説明)
- [データ分析機能](#データ分析機能)
- [技術スタック](#技術スタック)

## 機能概要

### 主な機能

1. **ユーザー管理**
   - ユーザー登録・ログイン・ログアウト
   - パスワードのハッシュ化による安全な認証

2. **メニュー閲覧**
   - 学食メニューの一覧表示
   - カテゴリ別表示
   - 平均評価・レビュー数の確認

3. **レビュー投稿・閲覧**
   - メニューに対する評価とコメントの投稿
   - 総合評価（1-5点）
   - 詳細評価（味・量・コスパ）
   - 自分のレビューの編集機能

4. **データ分析**
   - グラフによる可視化
   - 機械学習による分析（線形回帰）

## セットアップ

### 1. 必要なパッケージのインストール

```powershell
pip install -r requirements.txt
```

### 2. データベースの初期化とダミーデータの投入

```powershell
# データベースを作成し、ダミーデータを挿入
python insert_dummy_data.py
```

ダミーデータの内容:
- ユーザー: 30人
- カテゴリ: 6種類（定食、丼もの、麺類、カレー、軽食、デザート）
- メニュー: 23品目
- レビュー: 約400-500件

### 3. アプリケーションの起動

```powershell
python main.py
```

ブラウザで `http://127.0.0.1:5000` にアクセス

### 4. ログイン

新規ユーザを追加し、ログイン実施

## 使い方

### 基本的な流れ

1. **ユーザー登録**
   - 初回利用時は `/register` でユーザー登録
   - ユーザー名とパスワードを入力

2. **ログイン**
   - `/login` でログイン
   - 登録したユーザー名とパスワードを入力

3. **メニュー閲覧**
   - ログイン後、自動的にメニュー一覧画面へ
   - 各メニューの平均評価とレビュー数を確認

4. **メニュー詳細確認**
   - 気になるメニューの「詳細」リンクをクリック
   - メニュー情報と全レビューを閲覧

5. **レビュー投稿**
   - メニュー詳細画面で「レビューを投稿」をクリック
   - 評価とコメントを入力して投稿

6. **データ分析**
   - ナビゲーションの「データ分析」をクリック
   - 統計情報とグラフを確認

## 画面説明

### 1. ログイン画面 (`/login`)

**表示内容:**
- ユーザー名入力フィールド
- パスワード入力フィールド
- ログインボタン
- ユーザー登録へのリンク

**操作:**
1. ユーザー名とパスワードを入力
2. 「ログイン」ボタンをクリック
3. 認証成功でメニュー一覧へ遷移

**エラー:**
- ユーザー名またはパスワードが間違っている場合、エラーメッセージを表示

---

### 2. ユーザー登録画面 (`/register`)

**表示内容:**
- ユーザー名入力フィールド
- パスワード入力フィールド
- 登録ボタン
- ログイン画面へのリンク

**操作:**
1. 任意のユーザー名とパスワードを入力
2. 「登録」ボタンをクリック
3. 登録成功でログイン画面へ遷移

**バリデーション:**
- 全項目入力必須
- ユーザー名の重複チェック

---

### 3. メニュー一覧画面 (`/`)

**表示内容:**
- ログイン中のユーザー名
- ナビゲーションメニュー（メニュー一覧・データ分析・ログアウト）
- カテゴリ一覧
- メニュー一覧テーブル
  - メニュー名
  - カテゴリ
  - 価格
  - 平均評価
  - レビュー数
  - 詳細リンク

**操作:**
- 「詳細」リンクをクリックでメニュー詳細画面へ
- 「データ分析」リンクでデータ分析画面へ
- 「ログアウト」でログアウト

**特徴:**
- メニューごとの平均評価がリアルタイムで計算される
- レビュー数が0のメニューは評価0と表示

---

### 4. メニュー詳細画面 (`/menus/<id>`)

**表示内容:**

**メニュー情報:**
- メニュー名
- カテゴリ
- 価格
- 説明（ある場合）
- 平均評価（総合・味・量・コスパ）
- レビュー数

**レビュー投稿リンク:**
- 未投稿の場合: 「レビューを投稿」
- 投稿済みの場合: 「レビューを編集」

**レビュー一覧テーブル:**
- ユーザー名
- 総合評価
- 味の評価
- 量の評価
- コスパの評価
- コメント
- 投稿日時

**操作:**
- 「メニュー一覧に戻る」で一覧画面へ
- 「レビューを投稿/編集」でレビュー投稿画面へ

**表示ルール:**
- レビューは新しい順に表示
- 詳細評価（味・量・コスパ）が未入力の場合は「-」を表示

---

### 5. レビュー投稿画面 (`/menus/<id>/review`)

**表示内容:**
- メニュー名
- レビューフォーム
  - 総合評価（1-5の選択式、必須）
  - 味の評価（1-5の選択式、任意）
  - 量の評価（1-5の選択式、任意）
  - コスパの評価（1-5の選択式、任意）
  - コメント（テキストエリア、任意）
- 投稿/更新ボタン

**操作:**
1. 総合評価を選択（必須）
2. 必要に応じて詳細評価を選択
3. コメントを入力（任意）
4. 「投稿」または「更新」ボタンをクリック
5. メニュー詳細画面へ遷移

**機能:**
- 既存レビューがある場合は編集モード
  - フォームに既存の値が入力された状態で表示
  - ボタンが「更新」に変わる
- 1ユーザー1メニュー1レビューの制約

**バリデーション:**
- 総合評価は必須
- 評価は1-5の範囲チェック

---

### 6. データ分析画面 (`/analysis`)

**表示内容:**

#### 可視化分析グラフ

**人気メニューTOP10（横棒グラフ）**
- レビュー数が多いメニューを表示
- 人気度を視覚的に確認

## 技術スタック

### バックエンド
- **Flask**: Webフレームワーク
- **SQLAlchemy**: ORM（データベース操作）
- **Werkzeug**: パスワードハッシュ化

### フロントエンド
- **Jinja2**: テンプレートエンジン
- **HTML**: マークアップ
- **base64**: 画像埋め込み

### データベース
- **SQLite**: 軽量データベース

---

## データベース構造

### テーブル

#### users（ユーザー）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | Integer | 主キー |
| username | String(100) | ユーザー名（一意） |
| password_hash | String(200) | ハッシュ化されたパスワード |
| is_admin | Boolean | 管理者フラグ |
| created_at | DateTime | 登録日時 |

#### categories（カテゴリ）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | Integer | 主キー |
| name | String(50) | カテゴリ名（一意） |
| description | String(200) | 説明 |
| created_at | DateTime | 作成日時 |

#### menus（メニュー）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | Integer | 主キー |
| name | String(100) | メニュー名 |
| description | Text | 説明 |
| price | Integer | 価格（円） |
| category_id | Integer | カテゴリID（外部キー） |
| image_url | String(300) | 画像URL |
| is_available | Boolean | 提供状況 |
| created_at | DateTime | 作成日時 |
| updated_at | DateTime | 更新日時 |

#### reviews（レビュー）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | Integer | 主キー |
| user_id | Integer | ユーザーID（外部キー） |
| menu_id | Integer | メニューID（外部キー） |
| rating | Integer | 総合評価（1-5） |
| comment | Text | コメント |
| taste_rating | Integer | 味の評価（1-5） |
| volume_rating | Integer | 量の評価（1-5） |
| price_rating | Integer | コスパの評価（1-5） |
| created_at | DateTime | 投稿日時 |
| updated_at | DateTime | 更新日時 |

**制約:**
- (user_id, menu_id)の組み合わせは一意（1ユーザー1メニュー1レビュー）

---

## トラブルシューティング

### データベースエラー
```
sqlite3.OperationalError: no such table
```
→ `python insert_dummy_data.py` でデータベースを初期化

### ログインできない
- ユーザー名とパスワードを確認
- 新規ユーザーの場合は登録画面から登録

### グラフが表示されない
- レビューデータが不足している可能性
- `insert_dummy_data.py` を実行してダミーデータを挿入

### パッケージのインポートエラー
```
ModuleNotFoundError: No module named 'pandas'
```
→ `pip install -r requirements.txt` を実行
